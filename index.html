<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Field Register</title>
  <link href="https://fonts.googleapis.com/css2?family=Exo:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary-dark: #112b4e;
      --primary-mid: #8895a6;
      --primary-accent: #ec7723;

      --dark-80: rgba(17, 43, 78, 0.8);
      --dark-60: rgba(17, 43, 78, 0.6);
      --dark-40: rgba(17, 43, 78, 0.4);
      --dark-20: rgba(17, 43, 78, 0.2);
      --dark-10: rgba(17, 43, 78, 0.1);
      --dark-05: rgba(17, 43, 78, 0.05);

      --accent-80: rgba(236, 119, 35, 0.8);
      --accent-60: rgba(236, 119, 35, 0.6);
      --accent-40: rgba(236, 119, 35, 0.4);
      --accent-20: rgba(236, 119, 35, 0.2);
      --accent-10: rgba(236, 119, 35, 0.1);
      --accent-05: rgba(236, 119, 35, 0.05);
    }

    body {
      font-family: 'Exo', sans-serif;
      background-color: #f9f9f9;
      color: var(--primary-dark);
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }

    header {
      background-color: var(--primary-dark);
      height: 350px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      color: white;
      padding: 0 2rem;
    }

    .header-logo {
      height: 300px;
      width: auto;
      object-fit: contain;
      max-width: 600px;
    }

    .header-title {
      flex: 1;
      text-align: center;
    }

    .header-title h1 {
      font-weight: 600;
      font-size: 3rem;
      margin: 0;
    }

    .header-spacer {
      width: 300px; /* Same as logo width to center the title */
    }

    /* Responsive media queries for header logo */
    @media screen and (max-width: 1200px) {
      .header-logo {
        height: 250px;
        max-width: 500px;
      }
      .header-spacer {
        width: 250px;
      }
      .header-title h1 {
        font-size: 2.5rem;
      }
    }

    @media screen and (max-width: 768px) {
      header {
        height: 250px;
        padding: 0 1rem;
      }
      .header-logo {
        height: 200px;
        max-width: 350px;
      }
      .header-spacer {
        width: 200px;
      }
      .header-title h1 {
        font-size: 2rem;
      }
    }

    @media screen and (max-width: 480px) {
      header {
        height: 200px;
        padding: 0 0.5rem;
      }
      .header-logo {
        height: 160px;
        max-width: 200px;
      }
      .header-spacer {
        width: 160px;
      }
      .header-title h1 {
        font-size: 1.5rem;
      }
    }

    @media screen and (max-width: 320px) {
      header {
        height: 180px;
      }
      .header-logo {
        height: 130px;
        max-width: 150px;
      }
      .header-spacer {
        width: 130px;
      }
      .header-title h1 {
        font-size: 1.3rem;
      }
    }

    .container {
      max-width: 1000px;
      margin: -50px auto 0 auto;
      padding: 2rem;
      background: white;
      border-radius: 1rem;
      box-shadow: 0 0 10px var(--dark-10);
    }

    .form-switcher {
      margin-bottom: 2rem;
    }

    .form-switcher h2 {
      font-weight: 600;
      font-size: 1.2rem;
    }

    .form-switcher button {
      background-color: var(--accent-60);
      border: none;
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      margin: 0.5rem;
      border-radius: 0.5rem;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .form-switcher button:hover {
      background-color: var(--primary-accent);
    }

    .form-switcher button.active {
      background-color: var(--primary-accent);
    }

    .btn-back {
      background-color: #6c757d !important;
    } 
      
    .btn-back:hover {
      background-color: #5a6268 !important;
    }   
    
    .search-btn {
      background-color: var(--primary-accent);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    } 
      
    .thank-you-message {
      background-color: var(--accent-10);
      border: 2px solid var(--primary-accent);
      color: var(--primary-dark);
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 2rem;
      display: none;
    }

    .hidden {
      display: none;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section h3 {
      font-size: 1.5rem;
      margin-top: 0;
    }

    label {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: 600;
    }

    legend {
      display: block;
      margin: 1rem 0 0.5rem;
      font-weight: 600;
    }

    input[type="text"],
    input[type="date"],
    input[type="number"],
    input[type="tel"],
    select,
    textarea {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--dark-20);
      border-radius: 0.5rem;
      font-size: 1rem;
      font-family: 'Exo', sans-serif;
    }

    input[type="checkbox"] {
      margin-right: 0.5rem;
    }

    .form-footer {
      margin-top: 2rem;
      display: flex;
      justify-content: space-between;
    }

    .form-footer button {
      background-color: var(--primary-accent);
      color: white;
      font-weight: 600;
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 0.5rem;
      cursor: pointer;
    }

.field-error input {
  border: 2px solid #dc3545;
  background-color: #fff5f5;
}

.field-error label {
  color: #dc3545;
  font-weight: bold;
}

.form-wrapper {
  border: 1px solid var(--dark-20); /* Subtle border */
  padding: 1.5rem;
  border-radius: 1rem;
  max-width: 100%;
  box-sizing: border-box;
  overflow-x: auto; /* Ensure horizontal scrolling if content overflows */
}

input,
select,
textarea {
  max-width: 100%;
  box-sizing: border-box;
}

/* Specific styling for discipline checkboxes and their error messages */
.discipline-checkbox-group.field-error {
  border: 2px solid #dc3545;
  padding: 10px;
  border-radius: 0.5rem;
  background-color: #fff5f5;
}

.discipline-checkbox-group.field-error label {
  color: #dc3545;
}

    .week-ending-display {
      background-color: var(--accent-10);
      border: 2px solid var(--primary-accent);
      padding: 1rem;
      border-radius: 0.5rem;
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 1rem;
    }

    /* Style for the conditional discipline fields */
    .discipline-conditional-fields {
        border-left: 3px solid var(--primary-accent);
        padding-left: 15px;
        margin-top: 10px;
        margin-bottom: 15px;
        background-color: var(--accent-05);
        border-radius: 0.5rem;
        padding-top: 10px;
        padding-bottom: 10px;
    }

/* Styles for the main discipline checkboxes' labels */
.discipline-checkbox-group > div label {
    font-weight: bold; /* Make these labels bold */
    color: var(--primary-dark); /* Use a darker color */
    display: inline; /* Keep them inline with their checkboxes */
    margin-left: 5px; /* Add some space if the input is first */
    /* Add any other styles specific to these main labels */
}

/* Styles for labels within the conditional discipline fields */
.discipline-conditional-fields label {
    font-size: 0.95rem; /* Slightly smaller font for these */
    color: var(--primary-mid); /* Use a lighter color */
    display: inline; /* Keep them inline with their checkboxes */
    margin-bottom: 0.5rem; /* Add space below them */    }

    .discipline-conditional-fields input[type="number"] {
        width: calc(100% - 20px); /* Adjust width to fit padding */
        margin-bottom: 10px;
    }
/* More specifically, styles for the day checkboxes' labels */
.discipline-conditional-fields .days-checkbox-group label {
    font-weight: normal; /* Ensure they are not bold */
    color: var(--primary-dark); /* Can revert to primary-dark for contrast */
    display: inline; /* Keep them inline with their checkboxes */
    margin-left: 5px; /* Space next to the checkbox */
    margin-bottom: 0; /* Remove block margin */
}
    .discipline-conditional-fields .days-checkbox-group div {
        flex: 1 1 auto; /* Allow items to grow and shrink */
        min-width: 100px; /* Minimum width for each day checkbox */
    }
    .discipline-conditional-fields .days-checkbox-group input[type="checkbox"] {
        margin-right: 5px;
    }
    .error-field {
        border: 2px solid red !important;
        background-color: #ffe0e0 !important;
    }
    /* Optional: Style for the error messages */
    .error-message {
        margin-top: 5px;
        margin-bottom: 10px;
    }

.pitlinkin-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 15px;
  width: 100%;
}

.left-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex-shrink: 0;
}

.right-group {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  flex: 1;
}

.right-group label {
  white-space: nowrap; /* prevents label from wrapping */
 }

#pitlinkin-PitA-Note-ID {
  width: 100%;
}

.or-divider {
  display: flex;
  align-items: center;
  text-align: center;
  margin: 2rem 0;
  font-family: 'Exo', sans-serif;
}

.or-divider .line {
  flex-grow: 1;
  height: 1px;
  background-color: var(--accent-60);
  border: none;
}

.or-divider .or-text {
  padding: 0 1rem;
  font-weight: 600;
  color: var(--primary-accent);
  font-size: 1rem;
  white-space: nowrap;
}

  .disabled-label {
    color: gray;
    font-style: italic;
  }

.field-error-names {
  border: 2px solid red;
}

.crew-checkbox {
      border: 1px solid #ccc;
      border-radius: 0.5rem;
      background-color: #fff;
      padding: 1rem;
      max-height: 200px;
      overflow-y: auto;
      font-family: 'Exo', sans-serif;
    }
    .crew-checkbox label {
      display: block;
      margin-bottom: 0.25rem;
      cursor: pointer;
      color: var(--primary-dark);
    }
    .crew-checkbox input[type="checkbox"] {
      accent-color: var(--primary-accent);
      margin-right: 0.5rem;
      transform: scale(1.1);
    }
    .crew-checkbox p {
      color: var(--primary-mid);
      font-style: italic;
      margin: 0 0 0.5rem 0;
    }

  </style>

</head>
<body>
  <header>
    <img src="Field Register Header.png" alt="Field Register Logo" class="header-logo" />
    <div class="header-title">
      <h1>Field Register</h1>
    </div>
    <div class="header-spacer"></div>
  </header>

  <main class="container">
  <div class="form-wrapper">
  <div id="thank-you-message" class="thank-you-message" style="display: none;">
    <h3 id="message-title">Thank you!</h3>
    <p id="message-body">Your form has been submitted successfully.</p>
  </div>
    
    <section class="form-switcher">
      <h2>Please select which form you require:</h2>
      <button id="btn-bog" onclick="showForm('bog')">Boots on Ground</button>
      <button id="btn-progress" onclick="showForm('progress')">Progress Register</button>

    </section>

    <div id="form-bog" class="form-section hidden">
      <h3>Daily Pre-Start: Boots on Ground: Genus - Aura project</h3>
      <p>Please complete prior to starting work. <strong><u>Submission must be no later than 8am.</u></strong><br>This does not replace the JHA.</p>
      <form id="bog-form" onsubmit="validateBogForm()">

        <label for="bog-project">Project</label>
            <select id="bog-project" name="bog-project" required>
          <option value="Kalgoorlie-Wallaroo" selected>Kalgoorlie - Wallaroo</option>
        </select>

        <label for="bog-date">Date</label>
        <input type="date" id="bog-date" name="bog-date" required />

	<label for="bog-mob">
	<input type="checkbox" id="bog-mob" name="bog-mob" />
	Mobilisation Day
	</label>

	<label for="bog-demob">
	<input type="checkbox" id="bog-demob" name="bog-demob" />
	De-mobilisation Day
	</label>

        <label for="bog-company-name">Your Company Name</label>
        <select id="bog-company-name" name="bog-company-name" required>
          <option value="">Select one</option>
          <option value="Genus Services">Genus Services</option>
          <option value="JNJTech Services">JNJTech Services</option>
          <option value="MNC Drilling">MNC Drilling</option>
        </select>

<label for="bog-estimated-start-time">Estimated Start Time</label>
<select id="bog-estimated-start-time" name="bog-estimated-start-time" required></select>

<label for="bog-estimated-finish-time">Estimated Finish Time</label>
<select id="bog-estimated-finish-time" name="bog-estimated-finish-time" required></select>

<!-- Hidden fields to store timestamps in ISO format -->
<input type="hidden" id="bog-estimated-start-timestamp" name="bog-estimated-start-timestamp" />
<input type="hidden" id="bog-estimated-finish-timestamp" name="bog-estimated-finish-timestamp" />
        
        <label for="bog-discipline">Discipline</label>
        <select id="bog-discipline" name="bog-discipline" required>
          <option value="">Select one</option>
     <optgroup label="Construction">
          <option value="RRP">Rod, Rope & Prove</option>
          <option value="Blockage Repair">Blockage Repair</option>
          <option value="Plough">Plough</option>
          <option value="Horizontal Directional Drilling">Horizontal Directional Drilling</option>
          <option value="Trenching">Trenching</option>
          <option value="ACM Removal">ACM Removal</option>
          <option value="Pit Installation/Remediation">Pit Installation/Remediation</option>
          <option value="Reinstatement">Reinstatement</option>
          <option value="Cable Hauling">Cable Hauling</option>
          <option value="Traffic Management">Traffic Management</option>
          <option value="Supervision">Supervision</option>
     </optgroup>
        </select>

            <label for="bog-Location">Location</label>
        <textarea id="bog-Location" name="bog-Location" placeholder="Enter sheet number and grid reference" required></textarea>

    <label for="bog-site-contact">Onsite Crew Lead Name</label>
    <div id="bog-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="bog-site-contact-hidden" name="bog-site-contact" required />

        <label for="bog-onsite-crew-lead-mobile">Onsite Crew Lead Mobile</label>
        <input type="tel" id="bog-onsite-crew-lead-mobile" name="bog-onsite-crew-lead-mobile" pattern="04\d{8}" maxlength="10" placeholder="Enter 10-digit number" oninvalid="this.setCustomValidity('Enter number as 04xxxxxxxx')" oninput="this.setCustomValidity('')" required />

        <label for="bog-onsite-crew-lead-email">Onsite Crew Lead Email (optional)</label>
        <input type="text" id="bog-onsite-crew-lead-email" name="bog-onsite-crew-lead-email" />
        
        <label for="bog-Number-of-People-at-Location">Number of People in Crew at Location</label>
        <input type="number" id="bog-Number-of-People-at-Location" name="bog-Number-of-People-at-Location" min="1" step="1" required>
        
    <label for="bog-crews-names">Select Crew Members</label>
    <div id="bog-crews-names" class="crew-checkbox">
      <p>Select crew members for this location...</p>
    </div>
    <input type="hidden" id="bog-crews-names-hidden" name="bog-crews-names" required />
       
        <label for="bog-Genus-FCM">Your Genus FCM</label>
        <select id="bog-Genus-FCM" name="bog-Genus-FCM" required>
          <option value="">Select one</option>
          <option value="Alex McConville">Alex McConville</option>
          <option value="Damian Watson">Damian Watson</option>
        </select>
<br><br>
<div>
  <fieldset id="bog-swms-fieldset">
    <legend><strong>Discipline with task Specific SWMS</strong></legend>
    <p>
      (SWMS-SHEQ-CMS-0011 Site Establishment, SWMS-SHEQ-CMS-0001 Access to Pits & Manholes - required on all sites, SWMS-SHEQ-CMS-0006 Asbestos (ACM) required for all ACM sites)
    </p>
    <p>All workers to have signed into Task SWMS being utilised with copy available - latest version.</p>

    <input type="checkbox" name="bog-SWMS[]" value="Scoping" /> Scoping (0017 Surveying & Scoping)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Ploughing" /> Ploughing (0026 Ploughing & Cable Laying)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Trenching" /> Trenching (0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Drilling" /> Drilling (0016 Directional Boring, 0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Pit Installation" /> Pit Installation (0002 Installing Replacing Repairing Pits Manholes)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Hauling" /> Hauling (0008 Rod Roping & Cable Hauling)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Splicing" /> Splicing (0007 Cable Jointing)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Clear Blockage" /> Clear Blockage (0008 Rod Roping & Cable Hauling)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Service Locator" /> Service Locator (0012 Excavation & Trenching)<br />
    <input type="checkbox" name="bog-SWMS[]" value="Reinstatement" /> Reinstatement (0012 Excavation & Trenching)<br />

    <p id="swms-error" style="color: red; display: none;">Please select at least one SWMS discipline.</p>
  </fieldset>
</div>
                
<div id="bog-swms-section">
  <id="bog-jha-label">
    <label for="bog-jha-uploaded">
      I confirm all workers have been inducted and have signed onto the JHA.
    </label>
    <input type="checkbox" id="bog-jha-uploaded" name="bog-jha-uploaded" required>
    Please induct all visitors to JHA and complete prior to starting at each site.
  </div>

<div style="margin: 20px 0;">
  <label for="bog-jha-photos">
    Please provide a photo of the signed JHA (GPS time/date enabled)
    <br>
    <small style="color: #666;">
      Requires photo of front page and signed last page of the JHA
    </small>
  </label>

  <input 
    type="file" 
    id="bog-jha-photos" 
    name="bog_jha_photos[]"
    accept="image/*"
    multiple
    capture="environment"
    required
    style="margin-top: 10px; width: 100%; padding: 8px; border: 1px solid var(--dark-20); border-radius: 0.5rem; font-size: 1rem; font-family: 'Exo', sans-serif;"
  >

  <!-- Optional hint for users -->
  <p style="font-size: 0.9em; color: #555; margin-top: 8px;">
    You can select multiple photos or take new ones with your camera (enable GPS for time/date stamp).
  </p>
</div>

        <label for="bog-ACM">Will you be disturbing/modifying any possible ACM while onsite?</label>
        <select id="bog-ACM" name="bog-ACM" onchange="toggleACMField()" required>
          <option value="">Select one</option>
          <option value="Yes">Yes</option>
          <option value="No">No</option>
        </select>

<!-- Conditional Field -->
<div id="bog-acm-notification-field" style="display: none; margin-top: 10px;">
  <label for="bog-acm-yes">If yes, have you received your Genus ACM Removal Notification Code and placed on your Construction</label>
  Required for all ACM Pit replacement work, with Company Class B, worker to have remove Non-Friable accreditation with ACM supervisor in the vicinity.<br />
  <select id="bog-acm-yes" name="bog-acm-yes">
          <option value="">Select one</option>
          <option value="Yes">Yes, continue</option>
          <option value="No">No, stop work and contact your Genus FCM</option>
        </select>
</div>
                
<div id="bog-guards">
  <label for="bog-guards-checkbox">Are appropriate gas monitoring and trench guards in place?</label>
  <input type="checkbox" id="bog-guards-checkbox" name="bog-guards" /> Refer to HSE Guidance Note - Spot Sampling (Manhole) Gas Action Chart.
</div> 
               
<div id="bog-excavation">
  <label for="bog-excavation-checkbox">Is excavation work being conducted today?</label>
  <input type="checkbox" id="bog-excavation-checkbox" name="bog-excavation" /> Refer to HSE Guidance Note â€“ Construction JHA and Excavation permit process
</div>

<div style="margin: 20px 0;">
  <label for="bog-site-photos">
    Please provide a photo of your first site set-up for today (GPS time/date enabled)
    <br>
    <small style="color: #666;">
      Requires photo of a safe site set-up
    </small>
  </label>

  <input 
    type="file" 
    id="bog-site-photos" 
    name="bog_site_photos[]"
    accept="image/*"
    multiple
    capture="environment"
    required
    style="margin-top: 10px; width: 100%; padding: 8px; border: 1px solid var(--dark-20); border-radius: 0.5rem; font-size: 1rem; font-family: 'Exo', sans-serif;"
  >

  <!-- Optional hint for users -->
  <p style="font-size: 0.9em; color: #555; margin-top: 8px;">
    You can select multiple photos or take new ones with your camera (enable GPS for time/date stamp).
  </p>
</div>

        <label for="bog-comments">Additional Comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
        <textarea id="bog-comments" name="bog-comments" placeholder="Track required actions in MyOsh with SHEQ support"></textarea>

        <div class="form-footer">
          <button type="button" class="btn-back" onclick="confirmReset('bog')">Back</button>
          <button type="submit">Submit BOG</button>
        </div>
      </form>
    </div>

<div id="form-progress" class="form-section hidden">
  <h3>Progress Register: Genus Aura project</h3>
  <form id="progress-form" onsubmit="return validateProgressForm()">

    <label for="progress-project">Project</label>
    <select id="progress-project" name="progress-project" required>
      <option value="Kalgoorlie-Wallaroo" selected>Kalgoorlie - Wallaroo</option>
    </select>

    <label for="progress-date">Date</label>
    <input type="date" id="progress-date" name="progress-date" required />

    <label for="progress-company-name">Your Company Name</label>
    <select id="progress-company-name" name="progress-company-name" required>
      <option value="">Select one</option>
      <option value="Genus Services">Genus Services</option>
      <option value="JNJTech Services">JNJTech Services</option>
      <option value="MNC Drilling">MNC Drilling</option>
    </select>

    <label for="progress-site-contact">Onsite Crew Lead Name</label>
    <div id="progress-site-contact" class="crew-checkbox"></div>
    <input type="hidden" id="progress-site-contact-hidden" name="progress-site-contact" required />

    <label for="progress-onsite-crew-lead-mobile">Onsite Crew Lead Mobile</label>
    <input type="tel" id="progress-onsite-crew-lead-mobile" name="progress-onsite-crew-lead-mobile" pattern="04\d{8}" maxlength="10" placeholder="Enter 10-digit number" oninvalid="this.setCustomValidity('Enter number as 04xxxxxxxx')" oninput="this.setCustomValidity('')" required />

    <label for="progress-Location">Location</label>
    <textarea id="progress-Location" name="progress-Location" placeholder="Add sheet numbers for work completed" required></textarea>

    <fieldset>
      <legend>Select the activity type(s) your company has completed today:</legend>
      <div class="discipline-checkbox-group">
        <!-- Plough - Progress -->
        <div>
          <input type="checkbox" id="discipline-plough-progress" name="discipline[]" value="plough-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-plough-progress">Plough</label>
        </div>

        <div id="discipline-plough-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <label for="plough-progress-qty">Metres Completed:</label>
          <input type="number" id="plough-progress-qty" name="plough-progress-qty" min="0" step="0.1" />
        </div>

        <!-- Bore - Progress -->
        <div>
          <input type="checkbox" id="discipline-bore-progress" name="discipline[]" value="bore-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-bore-progress">Bore</label>
        </div>

        <div id="discipline-bore-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <!-- PE63 Size -->
          <div>
            <input type="checkbox" id="discipline-bore-pe63-progress" name="bore-size[]" value="bore-pe63-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-bore-pe63-progress">Size - PE63</label>
          </div>

          <div id="discipline-bore-pe63-progress-fields" class="discipline-conditional-fields" style="display: none;">
            <label for="bore-pe63-progress-qty">Metres Completed:</label>
            <input type="number" id="bore-pe63-progress-qty" name="bore-pe63-progress-qty" min="0" step="0.1" />
          </div>

          <!-- PE110 Size -->
          <div>
            <input type="checkbox" id="discipline-bore-pe110-progress" name="bore-size[]" value="bore-pe110-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-bore-pe110-progress">Size - PE110</label>
          </div>

          <div id="discipline-bore-pe110-progress-fields" class="discipline-conditional-fields" style="display: none;">
            <label for="bore-pe110-progress-qty">Metres Completed:</label>
            <input type="number" id="bore-pe110-progress-qty" name="bore-pe110-progress-qty" min="0" step="0.1" />
          </div>
        </div>

        <!-- Trench - Progress -->
        <div>
          <input type="checkbox" id="discipline-trench-progress" name="discipline[]" value="trench-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-trench-progress">Trench</label>
        </div>

        <div id="discipline-trench-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <!-- P50 Size -->
          <div>
            <input type="checkbox" id="discipline-trench-p50-progress" name="trench-size[]" value="trench-p50-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-trench-p50-progress">Size - P50</label>
          </div>

          <div id="discipline-trench-p50-progress-fields" class="discipline-conditional-fields" style="display: none;">
            <label for="trench-p50-progress-qty">Metres Completed:</label>
            <input type="number" id="trench-p50-progress-qty" name="trench-p50-progress-qty" min="0" step="0.1" />
          </div>

          <!-- P100 Size -->
          <div>
            <input type="checkbox" id="discipline-trench-p100-progress" name="trench-size[]" value="trench-p100-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-trench-p100-progress">Size - P100</label>
          </div>

          <div id="discipline-trench-p100-progress-fields" class="discipline-conditional-fields" style="display: none;">
            <label for="trench-p100-progress-qty">Metres Completed:</label>
            <input type="number" id="trench-p100-progress-qty" name="trench-p100-progress-qty" min="0" step="0.1" />
          </div>
        </div>

        <!-- Hauling - Progress -->
        <div>
          <input type="checkbox" id="discipline-hauling-progress" name="discipline[]" value="hauling-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-hauling-progress">Hauling (per cable)</label>
        </div>

        <div id="discipline-hauling-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <label for="hauling-progress-qty">Metres Completed:</label>
          <input type="number" id="hauling-progress-qty" name="hauling-progress-qty" min="0" step="0.1" />
        </div>

        <!-- RRP - Progress -->
        <div>
          <input type="checkbox" id="discipline-rrp-progress" name="discipline[]" value="rrp-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-rrp-progress">Rod, Rope & Prove</label>
        </div>

        <div id="discipline-rrp-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <label for="rrp-progress-qty">Metres Completed:</label>
          <input type="number" id="rrp-progress-qty" name="rrp-progress-qty" min="0" step="0.1" />
        </div>

        <!-- Blockages - Progress -->
        <div>
          <input type="checkbox" id="discipline-blockages-progress" name="discipline[]" value="blockages-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-blockages-progress">Blockages</label>
        </div>

        <div id="discipline-blockages-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <label for="blockages-progress-qty">Blockages Cleared:</label>
          <input type="number" id="blockages-progress-qty" name="blockages-progress-qty" min="0" step="1" />
        </div>

        <!-- Pits - Progress -->
        <div>
          <input type="checkbox" id="discipline-pit-progress" name="discipline[]" value="pit-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-pit-progress">Pits</label>
        </div>

        <div id="discipline-pit-progress-fields" class="discipline-conditional-fields" style="display: none;">
          
          <!-- New Pits -->
          <div>
            <input type="checkbox" id="discipline-pit-new-progress" name="pit-type[]" value="pit-new-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-pit-new-progress">New</label>
          </div>

          <div id="discipline-pit-new-progress-fields" class="discipline-conditional-fields" style="display: none;">
            
            <!-- C8 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-c8-progress" name="pit-new-size[]" value="pit-new-c8-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-c8-progress">C8</label>
            </div>

            <div id="discipline-pit-new-c8-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-c8-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-c8-progress-qty" name="pit-new-c8-progress-qty" min="0" step="1" />
            </div>

            <!-- C9 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-c9-progress" name="pit-new-size[]" value="pit-new-c9-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-c9-progress">C9</label>
            </div>

            <div id="discipline-pit-new-c9-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-c9-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-c9-progress-qty" name="pit-new-c9-progress-qty" min="0" step="1" />
            </div>

            <!-- Manhole Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-manhole-progress" name="pit-new-size[]" value="pit-new-manhole-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-manhole-progress">Manhole</label>
            </div>

            <div id="discipline-pit-new-manhole-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-manhole-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-manhole-progress-qty" name="pit-new-manhole-progress-qty" min="0" step="1" />
            </div>

            <!-- P5 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-p5-progress" name="pit-new-size[]" value="pit-new-p5-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-p5-progress">P5</label>
            </div>

            <div id="discipline-pit-new-p5-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-p5-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-p5-progress-qty" name="pit-new-p5-progress-qty" min="0" step="1" />
            </div>

            <!-- P6 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-p6-progress" name="pit-new-size[]" value="pit-new-p6-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-p6-progress">P6</label>
            </div>

            <div id="discipline-pit-new-p6-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-p6-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-p6-progress-qty" name="pit-new-p6-progress-qty" min="0" step="1" />
            </div>

            <!-- P8 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-p8-progress" name="pit-new-size[]" value="pit-new-p8-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-p8-progress">P8</label>
            </div>

            <div id="discipline-pit-new-p8-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-p8-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-p8-progress-qty" name="pit-new-p8-progress-qty" min="0" step="1" />
            </div>

            <!-- P9 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-new-p9-progress" name="pit-new-size[]" value="pit-new-p9-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-new-p9-progress">P9</label>
            </div>

            <div id="discipline-pit-new-p9-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-new-p9-progress-qty">Quantity:</label>
              <input type="number" id="pit-new-p9-progress-qty" name="pit-new-p9-progress-qty" min="0" step="1" />
            </div>
          </div>

          <!-- Replaced Pits -->
          <div>
            <input type="checkbox" id="discipline-pit-replaced-progress" name="pit-type[]" value="pit-replaced-progress" onchange="toggleDisciplineFields(this)" />
            <label for="discipline-pit-replaced-progress">Replaced With</label>
          </div>

          <div id="discipline-pit-replaced-progress-fields" class="discipline-conditional-fields" style="display: none;">
            
            <!-- C8 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-c8-progress" name="pit-replaced-size[]" value="pit-replaced-c8-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-c8-progress">C8</label>
            </div>

            <div id="discipline-pit-replaced-c8-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-c8-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-c8-progress-qty" name="pit-replaced-c8-progress-qty" min="0" step="1" />
            </div>

            <!-- C9 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-c9-progress" name="pit-replaced-size[]" value="pit-replaced-c9-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-c9-progress">C9</label>
            </div>

            <div id="discipline-pit-replaced-c9-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-c9-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-c9-progress-qty" name="pit-replaced-c9-progress-qty" min="0" step="1" />
            </div>

            <!-- Manhole Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-manhole-progress" name="pit-replaced-size[]" value="pit-replaced-manhole-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-manhole-progress">Manhole</label>
            </div>

            <div id="discipline-pit-replaced-manhole-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-manhole-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-manhole-progress-qty" name="pit-replaced-manhole-progress-qty" min="0" step="1" />
            </div>

            <!-- P5 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-p5-progress" name="pit-replaced-size[]" value="pit-replaced-p5-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-p5-progress">P5</label>
            </div>

            <div id="discipline-pit-replaced-p5-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-p5-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-p5-progress-qty" name="pit-replaced-p5-progress-qty" min="0" step="1" />
            </div>

            <!-- P6 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-p6-progress" name="pit-replaced-size[]" value="pit-replaced-p6-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-p6-progress">P6</label>
            </div>

            <div id="discipline-pit-replaced-p6-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-p6-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-p6-progress-qty" name="pit-replaced-p6-progress-qty" min="0" step="1" />
            </div>

            <!-- P8 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-p8-progress" name="pit-replaced-size[]" value="pit-replaced-p8-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-p8-progress">P8</label>
            </div>

            <div id="discipline-pit-replaced-p8-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-p8-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-p8-progress-qty" name="pit-replaced-p8-progress-qty" min="0" step="1" />
            </div>

            <!-- P9 Size -->
            <div>
              <input type="checkbox" id="discipline-pit-replaced-p9-progress" name="pit-replaced-size[]" value="pit-replaced-p9-progress" onchange="toggleDisciplineFields(this)" />
              <label for="discipline-pit-replaced-p9-progress">P9</label>
            </div>

            <div id="discipline-pit-replaced-p9-progress-fields" class="discipline-conditional-fields" style="display: none;">
              <label for="pit-replaced-p9-progress-qty">Quantity:</label>
              <input type="number" id="pit-replaced-p9-progress-qty" name="pit-replaced-p9-progress-qty" min="0" step="1" />
            </div>
          </div>
        </div>

        <!-- Marker Posts - Progress -->
        <div>
          <input type="checkbox" id="discipline-markers-progress" name="discipline[]" value="markers-progress" onchange="toggleDisciplineFields(this)" />
          <label for="discipline-markers-progress">Marker Posts</label>
        </div>

        <div id="discipline-markers-progress-fields" class="discipline-conditional-fields" style="display: none;">
          <label for="markers-progress-qty">Number Installed:</label>
          <input type="number" id="markers-progress-qty" name="markers-progress-qty" min="0" step="1" />
        </div>
      </div>
    </fieldset>

    <label for="progress-comments">Additional Comments? Escalate SHEQ concerns to your Genus FCM/Supervisor or SHEQ Advisor</label>
    <textarea id="progress-comments" name="progress-comments" placeholder="Track required actions in MyOsh with SHEQ support"></textarea>

    <div class="form-footer">
      <button type="button" class="btn-back" onclick="confirmReset('progress')">Back</button>
      <button type="submit">Submit Progress Register</button>
    </div>
  </form>
</div>
</main>

  <script>
  function confirmReset(formType) {
            const isConfirmed = confirm("Are you sure you want to reset this form and return to the form selection screen?");
            
            if (isConfirmed) {
                // Reset the specific form
                location.reload();
            }
        }

function toggleDisciplineFields(checkbox) {
    const discipline = checkbox.value.toLowerCase().replace(/\s/g, '-').replace(/--+/g, '-');
    const fieldsDiv = document.getElementById(`discipline-${discipline}-fields`);
    
    if (fieldsDiv) {
        if (checkbox.checked) {
            fieldsDiv.style.display = 'block';
            // Set crews to 1 by default, if empty
            const crewsInput = document.getElementById(`${discipline}-crews`);
            if (crewsInput && crewsInput.value === '') {
                crewsInput.value = '1';
            }
        } else {
            fieldsDiv.style.display = 'none';
            
            // Clear values when unchecked
            const crewsInput = document.getElementById(`${discipline}-crews`);
            if (crewsInput) {
                crewsInput.value = '';
            }
            
            // Clear quantity fields
            const qtyInput = document.getElementById(`${discipline}-qty`);
            if (qtyInput) {
                qtyInput.value = '';
            }
            
            // Uncheck and clear all sub-checkboxes within this discipline
            const subCheckboxes = fieldsDiv.querySelectorAll('input[type="checkbox"]');
            subCheckboxes.forEach(subCheckbox => {
                if (subCheckbox.checked) {
                    subCheckbox.checked = false;
                    // Recursively call toggleDisciplineFields to hide nested fields
                    toggleDisciplineFields(subCheckbox);
                }
            });
            
            // Clear all number inputs within this discipline
            const numberInputs = fieldsDiv.querySelectorAll('input[type="number"]');
            numberInputs.forEach(input => {
                input.value = '';
            });
            
            // Clear day checkboxes
            const daysCheckboxes = fieldsDiv.querySelectorAll(`input[name="${discipline}-days[]"]`);
            daysCheckboxes.forEach(dayCheckbox => {
                dayCheckbox.checked = false;
            });
            
            const daysError = document.getElementById(`${discipline}-days-error`);
            if (daysError) {
                daysError.style.display = 'none';
            }
        }
    }
}

    function toggleACMField() {
  const select = document.getElementById("bog-ACM");
  const acmField = document.getElementById("bog-acm-notification-field");
  const acmYes = document.getElementById("bog-acm-yes");

  if (select.value === "Yes") {
    acmField.style.display = "block";
    acmYes.setAttribute("required", "required");
  } else {
    acmField.style.display = "none";
    acmYes.removeAttribute("required");
  }
}

// Airtable configuration - Replace with your actual values
        const AIRTABLE_CONFIG = {
            bog: {
                baseId: 'appShjxvRISfybCBh',
                tableId: 'BOG',
                apiKey: 'patVqRGBoFq3KitRq.eb7e0b3d1bfb79012bdd2e2ea39e0cf3ebf73adc748d9311714d5c6863fa21cd'
            },
            progress: {
                baseId: 'appShjxvRISfybCBh',
                tableId: 'Progress Register',
                apiKey: 'patVqRGBoFq3KitRq.eb7e0b3d1bfb79012bdd2e2ea39e0cf3ebf73adc748d9311714d5c6863fa21cd'
            }
        };

	   // Global submitToAirtable function
           function submitToAirtable(formType, formData) {
            const config = AIRTABLE_CONFIG[formType];
            const url = `https://api.airtable.com/v0/${config.baseId}/${config.tableId}`;
            
            return fetch(url, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${config.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    records: [{
                        fields: formData
  		}],
 		typecast: true
	       })
            });
        }

        // Helper: Upload multiple files to Airtable and return attachment array
async function uploadFilesToAirtable(files, fieldName) {
    const attachments = [];

    for (const file of files) {
        try {
            // Step 1: Request upload URL from Airtable
            const uploadRequest = await fetch(
                `https://api.airtable.com/v0/meta/attachments/upload`,
                {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${config.apiKey}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        filename: file.name,
                        size: file.size,
                        type: file.type
                    })
                }
            );

            if (!uploadRequest.ok) throw new Error("Failed to get upload URL");

            const { url, id } = await uploadRequest.json();

            // Step 2: Upload the actual file to the pre-signed URL
            await fetch(url, {
                method: 'PUT',
                body: file,
                headers: {
                    'Content-Type': file.type
                }
            });

            // Step 3: Return attachment object for Airtable record
            attachments.push({
                url: url.split('?')[0], // remove query params
                filename: file.name,
                size: file.size,
                type: file.type
            });

        } catch (err) {
            console.error(`Error uploading ${file.name} for ${fieldName}:`, err);
            alert(`Failed to upload ${file.name}. Continuing without it.`);
        }
    }

    return attachments;
}


    // Set default date to today in Western Standard Time (Australia/Perth)
    function setDefaultDate() {
      const now = new Date();
      const perthTime = new Date(now.toLocaleString("en-US", {timeZone: "Australia/Perth"}));
      const year = perthTime.getFullYear();
      const month = String(perthTime.getMonth() + 1).padStart(2, '0');
      const day = String(perthTime.getDate()).padStart(2, '0');
      const todayString = `${year}-${month}-${day}`;
      
      // Set default date for all forms
      const bogDateField = document.getElementById('bog-date');
      const progressDateField = document.getElementById('progress-date');

      if (bogDateField) bogDateField.value = todayString;
      if (progressDateField) progressDateField.value = todayString;
    }
</script>

<script>
// Add this function to handle progress form validation
function validateProgressForm() {
    const form = document.getElementById('progress-form');
    let isValid = true;
    
    // Clear previous error styling
    clearFieldErrors(form);
    
    // Check basic form validity
    if (!form.checkValidity()) {
        isValid = false;
    }
    
    // Check if at least one discipline is selected
    const disciplineCheckboxes = form.querySelectorAll('input[name="discipline[]"]:checked');
    const disciplineError = document.getElementById('discipline-error');
    
    if (disciplineCheckboxes.length === 0) {
        disciplineError.style.display = 'block';
        document.querySelector('.discipline-checkbox-group').classList.add('field-error');
        isValid = false;
    } else {
        disciplineError.style.display = 'none';
        document.querySelector('.discipline-checkbox-group').classList.remove('field-error');
    }
    
    // Validate each selected discipline's conditional fields
    disciplineCheckboxes.forEach(checkbox => {
        const discipline = checkbox.value.toLowerCase().replace(/[^a-z]/g, '-');
        
        // For Plough - only validate metres completed
        if (discipline === 'plough-progress') {
            const qtyInput = document.getElementById('plough-progress-qty');
            if (qtyInput && (!qtyInput.value || qtyInput.value <= 0)) {
                qtyInput.classList.add('error-field');
                isValid = false;
            }
        }
        // For Bore - validate that at least one size is selected
        else if (discipline === 'bore-progress') {
            const boreSizeCheckboxes = form.querySelectorAll('input[name="bore-size[]"]:checked');
            
            if (boreSizeCheckboxes.length === 0) {
                // Show error that at least one bore size must be selected
                isValid = false;
            } else {
                // Validate metres for each selected bore size
                boreSizeCheckboxes.forEach(sizeCheckbox => {
                    const sizeValue = sizeCheckbox.value.toLowerCase(); // 'pe63' or 'pe110'
                    const qtyInput = document.getElementById(`bore-${sizeValue}-progress-qty`);
                    
                    if (qtyInput && (!qtyInput.value || qtyInput.value <= 0)) {
                        qtyInput.classList.add('error-field');
                        isValid = false;
                    }
                });
            }
        }
        // For other disciplines with crews and days
        else {
            // Check crews field
            const crewsInput = document.getElementById(`${discipline}-crews`);
            if (crewsInput && (!crewsInput.value || crewsInput.value < 1)) {
                crewsInput.classList.add('error-field');
                isValid = false;
            }
            
            // Check days selection
            const daysCheckboxes = form.querySelectorAll(`input[name="${discipline}-days[]"]:checked`);
            const daysError = document.getElementById(`${discipline}-days-error`);
            
            if (daysCheckboxes.length === 0) {
                if (daysError) {
                    daysError.style.display = 'block';
                }
                isValid = false;
            } else {
                if (daysError) {
                    daysError.style.display = 'none';
                }
            }
        }
    });
    
    if (!isValid) {
        showErrorMessage();
        addFieldErrorStyling(form);
        form.reportValidity();
        return false;
    }
    
    return true;
}

// Add this function to clear field errors
function clearFieldErrors(form) {
    // Remove error classes
    const errorFields = form.querySelectorAll('.field-error, .error-field');
    errorFields.forEach(field => {
        field.classList.remove('field-error', 'error-field');
    });
    
    // Hide error messages
    const errorMessages = form.querySelectorAll('.discipline-days-error');
    errorMessages.forEach(msg => {
        msg.style.display = 'none';
    });
}

function showForm(formType) {
    console.log('showForm called with:', formType);

    // Hide thank you message
    document.getElementById('thank-you-message').style.display = 'none';
        
    // Hide all forms using both methods
    const forms = ['form-bog', 'form-progress'];
    forms.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.classList.add('hidden');
            element.style.display = 'none';
        }
    });

    // Show selected form using both methods
    const targetForm = document.getElementById(`form-${formType}`);
    if (targetForm) {
        targetForm.classList.remove('hidden');
        targetForm.style.display = 'block';
        console.log(`Showing form: form-${formType}`);
    } else {
        console.error(`Form not found: form-${formType}`);
    }

      // Set default date for the current form
      setDefaultDate();

       // Hide all buttons except the selected one
            const buttons = ['btn-bog', 'btn-progress'];
            buttons.forEach(btnId => {
                const btn = document.getElementById(btnId);
                if (btn) {
                    if (btnId === `btn-${formType}`) {
                        btn.classList.add('active');
                        btn.style.display = 'inline-block';
                    } else {
                        btn.classList.remove('active');
                        btn.style.display = 'none';
                    }
                }
            });
        }

function validateSWMS() {
    const checkedSWMS = document.querySelectorAll('input[name="bog-SWMS[]"]:checked');
    const errorElement = document.getElementById('swms-error');
    
    if (checkedSWMS.length === 0) {
        // Show error message if it exists
        if (errorElement) {
            errorElement.style.display = 'block';
        }
        return false; // Prevent form submission
    } else {
        // Hide error message if it exists
        if (errorElement) {
            errorElement.style.display = 'none';
        }
        return true; // Allow form submission
    }
}

function validateBogForm() {
    const form = document.querySelector('#bog-form'); // Updated selector
    const isValid = form.checkValidity();
    const swmsValid = validateSWMS();
    
    if (!isValid || !swmsValid) {
        showErrorMessage();
        // Add red styling to invalid fields
	addFieldErrorStyling(form);
        form.reportValidity(); 
        return false;
    }
    
    return true;
}

function validateGenericForm(formId) {
    const form = document.getElementById(formId); // Updated selector
    const isValid = form.checkValidity();
    
    if (!isValid) {
        showErrorMessage();
        // Add red styling to invalid fields
	addFieldErrorStyling(form);
        form.reportValidity(); 
        return false;
    }
    
    return true;
}

  function addFieldErrorStyling(form) {
    // Remove existing error classes
    const existingErrors = form.querySelectorAll('.field-error');
    existingErrors.forEach(el => el.classList.remove('field-error'));
    
    // Add error class to invalid fields
    const invalidFields = form.querySelectorAll(':invalid');
    invalidFields.forEach(field => {
        field.classList.add('field-error');
        // Also add to parent if it's a field container
        if (field.parentElement) {
            field.parentElement.classList.add('field-error');
        }
    });
}

function showErrorMessage() {
    const messageBox = document.getElementById('thank-you-message');
    const messageTitle = document.getElementById('message-title');
    const messageBody = document.getElementById('message-body');
    
    // Show error message
    messageTitle.textContent = '';
    messageBody.textContent = 'Please review your submission and ensure all fields are completed.';
    messageBody.style.color = 'red';
    messageBox.style.display = 'block';
}

function showSuccessMessage() {
    const messageBox = document.getElementById('thank-you-message');
    const messageTitle = document.getElementById('message-title');
    const messageBody = document.getElementById('message-body');
    
    // Show success message
    messageTitle.textContent = 'Thank you!';
    // Added button and auto-redirect message
    messageBody.innerHTML = 'Your form has been submitted successfully.<br><br><button type="button" class="btn-back" onclick="returnToFormSwitcher()">Submit Another Form</button><br><small>You will be redirected to form selection in 5 seconds...</small>';
    messageBody.style.color = ''; // Reset color to default
    messageBox.style.display = 'block';
    
    // Auto-redirect after 5 seconds
    setTimeout(() => {
        returnToFormSwitcher();
        document.getElementById('thank-you-message').style.display = 'none';
    }, 5000);
}

// Optional: Function to reset/hide the message
function hideMessage() {
    const messageBox = document.getElementById('thank-you-message');
    messageBox.style.display = 'none';
  // Hide message if validation passes (you may replace this with success logic)
  messageBox.style.display = 'none';
  return true;
}

    // Initialize default dates when the page loads
    document.addEventListener('DOMContentLoaded', function() {
      setDefaultDate();

       // Add event listeners for each form
document.getElementById('bog-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    // Your existing validation
    if (!validateBogForm()) return;

    // Disable button during submission
    const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    submitBtn.textContent = "Submitting...";

    try {
        // Step 1: Collect all non-file form data
        const checkedSWMS = Array.from(document.querySelectorAll('input[name="bog-SWMS[]"]:checked'))
            .map(cb => cb.value);

        const formData = {
            "Project": document.getElementById('bog-project')?.value || "Kalgoorlie - Wallaroo",
            "Form Date": document.getElementById('bog-date').value,
            "Is Mobilisation Day": document.getElementById('bog-mob').checked,
            "Is Demobilisation Day": document.getElementById('bog-demob').checked,
            "Company Name": document.getElementById('bog-company-name').value,
            "Discipline": document.getElementById('bog-discipline').value,
            "Estimated Start Time2": document.getElementById('bog-estimated-start-timestamp').value || "",
            "Estimated Finish Time2": document.getElementById('bog-estimated-finish-timestamp').value || "",
            "Location / Grid Reference": document.getElementById('bog-Location').value,
            "Onsite Crew Lead Name": document.getElementById('bog-site-contact-hidden').value,
            "Onsite Crew Lead Mobile": document.getElementById('bog-onsite-crew-lead-mobile').value,
            "Onsite Crew Lead Email": document.getElementById('bog-onsite-crew-lead-email').value || "",
            "Number of People at Location": Number(document.getElementById('bog-Number-of-People-at-Location').value) || 0,
            "Selected Crew Members": document.getElementById('bog-crews-names-hidden').value,
            "Genus FCM": document.getElementById('bog-Genus-FCM').value,
            "SWMS Selected": checkedSWMS,
            "JHA Signed & Inducted": document.getElementById('bog-jha-uploaded').checked,
            "ACM Disturbance Planned?": document.getElementById('bog-ACM').value,
            "ACM Notification Received & on JHA": document.getElementById('bog-acm-yes')?.value === "Yes",
            "Gas Monitoring & Trench Guards in Place": document.getElementById('bog-guards-checkbox')?.checked || false,
            "Excavation Work Today": document.getElementById('bog-excavation-checkbox')?.checked || false,
            "Additional Comments": document.getElementById('bog-comments').value || "",
            "Number of Crew vehicles": Number(document.getElementById('bog-crew-vehicles')?.value) || 0,
            "Number of heavy vehicles": Number(document.getElementById('bog-heavy-vehicles')?.value) || 0,
        };

        // Step 2: Handle file uploads (JHA Photos + Site Setup Photos)
        const jhaFiles = document.getElementById('bog-jha-photos').files;
        const siteFiles = document.getElementById('bog-site-photos').files;

        const jhaAttachments = await uploadFilesToAirtable(jhaFiles, "JHA Photos");
        const siteAttachments = await uploadFilesToAirtable(siteFiles, "Site Setup Photos");

        if (jhaAttachments.length > 0) {
            formData["JHA Photos"] = jhaAttachments;
        }
        if (siteAttachments.length > 0) {
            formData["Site Setup Photos"] = siteAttachments;
        }

        // Step 3: Submit the record (including attachments)
        const response = await submitToAirtable('bog', formData);
const result = await response.json();

if (!response.ok) {
    throw new Error(result.error?.message || 'Airtable submission failed');
}

        showSuccessMessage();
        console.log("BOG record created successfully with photos");

    } catch (err) {
        console.error("Submission error:", err);
        alert("Error submitting form: " + err.message);
    } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = "Submit BOG";
    }
});

        document.getElementById('progress-form').addEventListener('submit', async function(e) {
            e.preventDefault();
const submitButton = this.querySelector('button[type="submit"]');
  if (submitButton) {
    submitButton.disabled = true;
    submitButton.textContent = "Submitting...";
    setTimeout(() => {
      submitButton.disabled = false;
      submitButton.textContent = "Submit Progress Register";
    }, 7000);
  }

    // --- New 5-7-digit ID Validation (Updated) ---
    let isValid = true;
    const idFieldsToValidate = [
        { id: 'progress-Pit-Note-ID', name: 'Pit Note ID' },
    ];
    let errorMessage = '';

    idFieldsToValidate.forEach(fieldInfo => {
        const inputElement = document.getElementById(fieldInfo.id);
        const value = inputElement ? inputElement.value.trim() : '';

        // Validate if the input element exists and is not disabled.
        if (inputElement && !inputElement.disabled) {
            // Check for between 5-7 digits
            if (!/^\d{5,7}$/.test(value)) {
                errorMessage += `- '${fieldInfo.name}' must contain between 5-7 digits.\n`;
                inputElement.classList.add('field-error'); // Add error styling
                isValid = false;
            } else {
                inputElement.classList.remove('field-error'); // Remove error styling if valid
            }
        } else if (inputElement) {
            // Ensure no error styling if the field is disabled
            inputElement.classList.remove('field-error');
        }
    });

    // If a value is empty, it won't match /^\d{5,7}$/ and will be flagged.

    if (!isValid) {
        alert('Please correct the following errors before submitting:\n' + errorMessage);
        return; // Prevent submission if validation fails
    }

       // Validate the form
        if (!validateGenericForm('progress-form')) {
            return;
        }
            
            // Collect form data - modify this based on your actual form fields
            const formData = {
                'Contractor': document.getElementById('progress-company-name').value,
                'Submission Date': document.getElementById('progress-date').value,
                'SAM': document.getElementById('progress-SAM').value,
                'ADA ID': document.getElementById('progress-ADA').value,
                'Pit Note ID': document.getElementById('progress-Pit-Note-ID').value,
                'Additional Comments': document.getElementById('progress-comments').value,
		'Pit Cleanout Completed': document.getElementById('progress-completed').checked
            };
            
            try {
                // showSuccessMessage();
const response = await submitToAirtable('progress', formData);
const result = await response.json();

if (!response.ok) {
  console.error('Airtable error:', result);
  alert(`Submission failed: ${result.error?.message || 'Unknown error'}`);
  return;
}

showSuccessMessage();
            } catch (error) {
                console.error('Error submitting Progress Register form:', error);
                alert('Error submitting form. Please try again.');
            }
        });
    
    // Hide all forms using both methods
const forms = ['form-bog', 'form-progress'];
forms.forEach(id => {
    const element = document.getElementById(id);
    if (element) {
        element.classList.add('hidden');
        // Optional: skip this if .hidden already handles display:none
        element.style.display = 'none';

        if (element.tagName === 'FORM') {
            element.reset();
        }

        const errorFields = element.querySelectorAll('.field-error');
        errorFields.forEach(field => field.classList.remove('field-error'));
    }
});

    // Show all buttons and remove active state
    const buttons = ['btn-bog', 'btn-progress'];
    buttons.forEach(btnId => {
        const btn = document.getElementById(btnId);
        if (btn) {
            btn.style.display = 'inline-block';
            btn.classList.remove('active');
        }
    });
});
  </script>

<script>
  function returnToFormSwitcher() {
    location.reload();
  }
</script>

  <script>
    function initAutocomplete() {
      const inputs = document.querySelectorAll(".address-autocomplete");
      inputs.forEach(input => {
        new google.maps.places.Autocomplete(input, {
          types: ['geocode'],
          componentRestrictions: { country: 'au' }
        });
      });
    }
  </script>

  <script>
document.addEventListener("DOMContentLoaded", function () {
  const webAppUrl =
    "https://script.google.com/macros/s/AKfycbxTwTxPftHM_vTtyiAMz0m5TUJblS2PmcLAAOL2U0OLWx2gQqF7DaYM6aC3HZ8bIj1BcQ/exec";

  // Sections configuration
  const sections = [
    { crew: "bog-crews-names", lead: "bog-site-contact", multiCrew: true, companyField: "bog-company-name" },
    { lead: "progress-site-contact", companyField: "progress-company-name" }
  ];

  async function fetchCrewNames(company) {
    if (!company) return [];
    try {
      const url = `${webAppUrl}?company=${encodeURIComponent(company)}`;
      const res = await fetch(url);
      return await res.json();
    } catch (err) {
      console.error("Failed to fetch crew names:", err);
      return [];
    }
  }

  function createRadioList(containerEl, hiddenInput, crewList) {
    containerEl.innerHTML = "";
    crewList.forEach(name => {
      const label = document.createElement("label");
      label.style.display = "block";
      const radio = document.createElement("input");
      radio.type = "radio";
      radio.name = containerEl.id + "-radio";
      radio.value = name;
      radio.addEventListener("change", () => hiddenInput.value = name);
      label.appendChild(radio);
      label.appendChild(document.createTextNode(name));
      containerEl.appendChild(label);
    });
  }

  function createCheckboxList(containerEl, hiddenInput, crewList) {
    containerEl.innerHTML = "";
    crewList.forEach(name => {
      const label = document.createElement("label");
      label.style.display = "block";
      const checkbox = document.createElement("input");
      checkbox.type = "checkbox";
      checkbox.value = name;
      checkbox.addEventListener("change", () => {
        const selected = Array.from(containerEl.querySelectorAll("input[type=checkbox]:checked")).map(cb => cb.value);
        hiddenInput.value = selected.join(", ");
      });
      label.appendChild(checkbox);
      label.appendChild(document.createTextNode(name));
      containerEl.appendChild(label);
    });
  }

  async function initSections() {
    for (const section of sections) {
      const hiddenLead = section.lead ? document.getElementById(section.lead + "-hidden") : null;
      const leadEl = section.lead ? document.getElementById(section.lead) : null;
      const hiddenCrew = section.crew ? document.getElementById(section.crew + "-hidden") : null;
      const crewEl = section.crew ? document.getElementById(section.crew) : null;

      let companyName = section.companyField ? document.getElementById(section.companyField)?.value : "Genus Services";

      const crewList = await fetchCrewNames(companyName);

      // Only BOG has crew names
      if (crewEl && hiddenCrew && section.multiCrew) {
        createCheckboxList(crewEl, hiddenCrew, crewList);
      }

      // Site contact for all sections
      if (leadEl && hiddenLead) {
        createRadioList(leadEl, hiddenLead, crewList);
      }

      // Update lists if company field changes dynamically
      if (section.companyField) {
        const companyEl = document.getElementById(section.companyField);
        if (companyEl) {
          companyEl.addEventListener("change", async () => {
            const updatedList = await fetchCrewNames(companyEl.value);
            if (crewEl && hiddenCrew && section.multiCrew) createCheckboxList(crewEl, hiddenCrew, updatedList);
            if (leadEl && hiddenLead) createRadioList(leadEl, hiddenLead, updatedList);
          });
        }
      }
    }
  }

  initSections();
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function () {
  function generateTimeOptions(selectId) {
    const select = document.getElementById(selectId);
    if (!select) return;

    for (let hour = 0; hour < 24; hour++) {
      for (let min = 0; min < 60; min += 30) {
        const hourStr = hour.toString().padStart(2, '0');
        const minStr = min.toString().padStart(2, '0');
        const time24 = `${hourStr}:${minStr}`; // 24-hour format for value

        // Convert to 12-hour format for display
        let displayHour = hour % 12;
        displayHour = displayHour === 0 ? 12 : displayHour;
        const ampm = hour < 12 ? 'AM' : 'PM';
        const displayStr = `${displayHour}:${minStr} ${ampm}`;

        const option = document.createElement('option');
        option.value = time24;       // 24-hour format value
        option.textContent = displayStr; // 12-hour format display
        select.appendChild(option);
      }
    }
  }

  generateTimeOptions('bog-estimated-start-time');
  generateTimeOptions('bog-estimated-finish-time');

  function updateBogTimestamps() {
    const dateEl = document.getElementById('bog-date');
    const startEl = document.getElementById('bog-estimated-start-time');
    const finishEl = document.getElementById('bog-estimated-finish-time');
    const outStart = document.getElementById('bog-estimated-start-timestamp');
    const outFinish = document.getElementById('bog-estimated-finish-timestamp');

    if (dateEl && startEl && finishEl && outStart && outFinish) {
      const date = dateEl.value;
      const start = startEl.value;
      const finish = finishEl.value;
      if (date && start && finish) {
        outStart.value = date + 'T' + start + ':00';
        outFinish.value = date + 'T' + finish + ':00';
      }
    }
  }

  document.getElementById('bog-estimated-start-time')?.addEventListener('change', updateBogTimestamps);
  document.getElementById('bog-estimated-finish-time')?.addEventListener('change', updateBogTimestamps);
  document.getElementById('bog-date')?.addEventListener('change', updateBogTimestamps);
  document.getElementById('bog-form')?.addEventListener('submit', updateBogTimestamps);
});
</script>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA-EKPtC5W7fRHgiONVPIyGsVU7Ti_xjBc&libraries=places&callback=initAutocomplete" async defer></script>
</body>
</html>
